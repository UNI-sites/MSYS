<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Example</title>
</head>
<body>
    <main class="container">
        <h1>Examination in MSYS</h1>
        <p class="intro">Hvis du finder fejl eller et svar, som du er uenig i, så send venligst en besked med hvorfor det er forkert, inklusive beregning og forklaring.</p>

        <form id="quizForm" novalidate>

            <!-- Spørgsmål 1 -->
            <section class="question" aria-labelledby="q1">
                <h2 id="q1">(8 point) Hvordan gemmes det negative tal -35 på 2-komplement form (i et 8 bit system) ?</h2>
                <div class="options">
                    <label><input type="radio" name="q1" value="0b00100011" required> 0b00100011</label>
                    <label><input type="radio" name="q1" value="0b11011101"> 0b11011101</label>
                    <label><input type="radio" name="q1" value="0b11011011"> 0b11011011</label>
                    <label><input type="radio" name="q1" value="0b11100011"> 0b11100011</label>
                </div>
                <div class="feedback" data-for="q1"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q1">Tjek svar (1)</button></div>
            </section>

            <!-- Spørgsmål 2 -->
            <section class="question" aria-labelledby="q2">
                <h2 id="q2">(8 point) Hvad gælder lige efter RESET af en Atmel AVR microcontroller ?</h2>
                <div class="options">
                    <label><input type="radio" name="q2" value="opt1" required> Programtælleren er 0, og global interrupt (I-bit i SREG) er aktiveret.</label>
                    <label><input type="radio" name="q2" value="opt2"> Programtælleren peger på adressen for stack-toppen</label>
                    <label><input type="radio" name="q2" value="opt3"> Programtælleren peger på den sidste instruktion lige før RESET.</label>
                    <label><input type="radio" name="q2" value="opt4"> Programtælleren er 0, og alle I/O porte er konfigureret som input.</label>
                </div>
                <div class="feedback" data-for="q2"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q2">Tjek svar (2)</button></div>
            </section>

            <!-- Spørgsmål 3 -->
            <section class="question" aria-labelledby="q3">
                <h2 id="q3">(10 point) Hvad indeholder R21 efter afvikling af denne kode:
                    <pre>LDI R21,21
DEC R21
PUSH R21
LDI R22,22
ADD R21,R22
POP R21
INC R21</pre>
                    Stack pointeren er på forhånd korrekt initieret.</h2>
                <div class="options">
                    <label><input type="radio" name="q3" value="44" required> 44</label>
                    <label><input type="radio" name="q3" value="22"> 22</label>
                    <label><input type="radio" name="q3" value="42"> 42</label>
                    <label><input type="radio" name="q3" value="21"> 21</label>
                </div>
                <div class="feedback" data-for="q3"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q3">Tjek svar (3)</button></div>
            </section>

            <!-- Spørgsmål 4 -->
            <section class="question" aria-labelledby="q4">
                <h2 id="q4">(10 point) Hvilken af de 4 viste måder at skrive en assembly subrutine vil medføre, at programmet "går ned" (eksekverer uforudsigeligt), hvis subrutinen kaldes ?
                    <br>Stack pointeren er på forhånd korrekt initieret.</h2>
                <div class="options">
                    <label><input type="radio" name="q4" value="opt1" required> HERE: PUSH R17<br>&nbsp;&nbsp;&nbsp;&nbsp;POP R16<br>&nbsp;&nbsp;&nbsp;&nbsp;RET</label>
                    <label><input type="radio" name="q4" value="opt2"> HERE: PUSH R16<br>&nbsp;&nbsp;&nbsp;&nbsp;ADD R16,R17<br>&nbsp;&nbsp;&nbsp;&nbsp;RET</label>
                    <label><input type="radio" name="q4" value="opt3"> HERE: PUSH R16<br>&nbsp;&nbsp;&nbsp;&nbsp;PUSH R17<br>&nbsp;&nbsp;&nbsp;&nbsp;ADD R16,R17<br>&nbsp;&nbsp;&nbsp;&nbsp;POP R18<br>&nbsp;&nbsp;&nbsp;&nbsp;POP R17<br>&nbsp;&nbsp;&nbsp;&nbsp;RET</label>
                    <label><input type="radio" name="q4" value="opt4"> HERE: PUSH R16<br>&nbsp;&nbsp;&nbsp;&nbsp;ADD R16,R17<br>&nbsp;&nbsp;&nbsp;&nbsp;POP R17<br>&nbsp;&nbsp;&nbsp;&nbsp;RET</label>
                </div>
                <div class="feedback" data-for="q4"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q4">Tjek svar (4)</button></div>
            </section>

            <!-- Spørgsmål 5 -->
            <section class="question" aria-labelledby="q5">
                <h2 id="q5">(10 point) Hvor mange CPU clock-cycles tager det en Mega2560 at afvikle denne kode:
                    <pre>       LDI  R18,10
OUTER: LDI  R20,20
INNER: DEC  R20
       BRNE INNER
       DEC  R18
       BRNE OUTER</pre></h2>
                <div class="options">
                    <label><input type="radio" name="q5" value="630" required> 630</label>
                    <label><input type="radio" name="q5" value="567"> 567</label>
                    <label><input type="radio" name="q5" value="200"> 200</label>
                    <label><input type="radio" name="q5" value="420"> 420</label>
                </div>
                <div class="feedback" data-for="q5"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q5">Tjek svar (5)</button></div>
            </section>

            <!-- Spørgsmål 6 -->
            <section class="question" aria-labelledby="q6">
                <h2 id="q6">(12 point) Dette assembly-program afvikles på et "Arduino Mega2560" board med påmonteret "Mega2560 I/O Shield" (kendt fra øvelserne):
                    <pre>      CLR  R20
      LDI  R21,0xFF 
      OUT  DDRA,R20
      OUT  DDRB,R21
IGEN: SBIS PINA,1
      OUT  PORTB,R21
      SBIS PINA,0
      OUT  PORTB,R20
      JMP  IGEN</pre>
                    Hvordan virker programmet ?
                    <br>Husk:
                    <ul>
                        <li>Signalet fra en trykknap går LAVT, når der trykkes på den.</li>
                        <li>En lysdiode tændes, når signalet til den går HØJT.</li>
                    </ul>
                </h2>
                <div class="options">
                    <label><input type="radio" name="q6" value="opt1" required> Når der trykkes på trykknap SW1, tænder alle lysdioder. Når der trykkes på trykknap SW0, slukker alle lysdioder</label>
                    <label><input type="radio" name="q6" value="opt2"> Når der trykkes på trykknap SW1 eller trykknap SW0, slukker alle lysdioder</label>
                    <label><input type="radio" name="q6" value="opt3"> Når der trykkes på trykknap SW1 eller trykknap SW0, tænder alle lysdioder</label>
                    <label><input type="radio" name="q6" value="opt4"> Når der trykkes på trykknap SW1, slukker alle lysdioder. Når der trykkes på trykknap SW0, tænder alle lysdioder</label>
                </div>
                <div class="feedback" data-for="q6"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q6">Tjek svar (6)</button></div>
            </section>

            <!-- Spørgsmål 7 -->
            <section class="question" aria-labelledby="q7">
                <h2 id="q7">(10 point) En Mega2560 har en CPU clockfrekvens på 4 MHz.
                    <br>Hvor lang tid tager det at afvikle denne kode:
                    <pre>      CLR R30
HERE: DEC R30
      NOP
      BRNE HERE</pre></h2>
                <div class="options">
                    <label><input type="radio" name="q7" value="768us" required> 768 mikrosekunder</label>
                    <label><input type="radio" name="q7" value="192us"> 192 mikrosekunder</label>
                    <label><input type="radio" name="q7" value="1024us"> 1024 mikrosekunder</label>
                    <label><input type="radio" name="q7" value="256us"> 256 mikrosekunder</label>
                </div>
                <div class="feedback" data-for="q7"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q7">Tjek svar (7)</button></div>
            </section>

            <!-- Spørgsmål 8 -->
            <section class="question" aria-labelledby="q8">
                <h2 id="q8">(10 point) Følgende C kode statement oversættes af en C compiler til Atmel AVR assembly kode:
                    <pre>PORTB =  (~PINA) | 97;</pre>
                    Hvilken assembly kode er korrekt</h2>
                <div class="options">
                    <label><input type="radio" name="q8" value="opt1" required> IN  R24, PINA<br>COM R24<br>LDI R25, 97<br>OR  R24, R25<br>OUT PORTB, R24</label>
                    <label><input type="radio" name="q8" value="opt2"> LDI R24, 97<br>IN  R25, PINA<br>COM R24<br>OR  R24, R25<br>OUT PORTB, R24</label>
                    <label><input type="radio" name="q8" value="opt3"> IN  R24, PINA<br>LDI R25, 97<br>COM R25<br>OR  R24, R25<br>OUT PORTB, R24</label>
                    <label><input type="radio" name="q8" value="opt4"> IN  R24, PINA<br>COM R24<br>LDI R25, 97<br>ADD R24, R25<br>OUT PORTB, R24</label>
                </div>
                <div class="feedback" data-for="q8"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q8">Tjek svar (8)</button></div>
            </section>

            <!-- Spørgsmål 9 -->
            <section class="question" aria-labelledby="q9">
                <h2 id="q9">(11 point) Hvilket C statement svarer til følgende Atmel AVR assembly kode:
                    <pre>IN  R25,PINA
IN  R24,PINB
AND R24,R25
DEC R24
OUT PORTC,R24</pre></h2>
                <div class="options">
                    <label><input type="radio" name="q9" value="opt1" required> PORTC = PINA & (PINB - 1)</label>
                    <label><input type="radio" name="q9" value="opt2"> PORTC = (PINB & PINA) - 1;</label>
                    <label><input type="radio" name="q9" value="opt3"> PORTC = (PINB & PINA) + 1;</label>
                    <label><input type="radio" name="q9" value="opt4"> PORTC = PINA & (PINB - 1)</label>
                </div>
                <div class="feedback" data-for="q9"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q9">Tjek svar (9)</button></div>
            </section>

            <!-- Spørgsmål 10 -->
            <section class="question" aria-labelledby="q10">
                <h2 id="q10">(9 point) På et "Arduino Mega2560 board" med påmonteret "Mega250 I/O shield", er de 8 lysdioder (LED7 - LED0) forbundet til Mega2560's PB ben.
                    <br>Hvilken kode tænder lysdioden LED4 og slukker alle de andre lysdioder</h2>
                <div class="options">
                    <label><input type="radio" name="q10" value="opt1" required> DDRB  = 0b11111111; <br>PORTB = 0b11101111</label>
                    <label><input type="radio" name="q10" value="opt2"> DDRB  = 0b00000000; <br>PORTB = 0b11101111</label>
                    <label><input type="radio" name="q10" value="opt3"> DDRB  = 0b11111111; <br>PORTB = 0b00010000</label>
                    <label><input type="radio" name="q10" value="opt4"> DDRB  = 0b00000000; <br>PORTB = 0b00010000</label>
                </div>
                <div class="feedback" data-for="q10"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q10">Tjek svar (10)</button></div>
            </section>

            <!-- Spørgsmål 11 -->
            <section class="question" aria-labelledby="q11">
                <h2 id="q11">(11 point) En Mega2560 har en CPU clockfrekvens på 8 MHz.
                    <br>Vi sætter timer 4 i "Normal Mode".
                    <br>Hvad er den længste tid, som man kan få mellem to efterfølgende timer 4 overflows ?</h2>
                <div class="options">
                    <label><input type="radio" name="q11" value="32.80ms" required> 32,80 millisekunder</label>
                    <label><input type="radio" name="q11" value="2.097s"> 2,097 sekunder</label>
                    <label><input type="radio" name="q11" value="8.39s"> 8,39 sekunder</label>
                    <label><input type="radio" name="q11" value="0.256ms"> 0,256 millisekunder</label>
                </div>
                <div class="feedback" data-for="q11"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q11">Tjek svar (11)</button></div>
            </section>

            <!-- Spørgsmål 12 -->
            <section class="question" aria-labelledby="q12">
                <h2 id="q12">(12 point) Timer 1 anvendes i Normal Mode, og timer 1's clock prescaler er sat til 1024.
                    <br>Mega2560's clock frekvens er 16 MHz.
                    <br>Hvilken værdi skal der skrives til TCNT1, når der ønskes en forsinkelse på 2 sekunder fra der skrives til TCNT1, og indtil timer 1 laver overflow ?</h2>
                <div class="options">
                    <label><input type="radio" name="q12" value="15625" required> TCNT1 = 15625;</label>
                    <label><input type="radio" name="q12" value="65536-31250"> TCNT1 = (65536-31250);</label>
                    <label><input type="radio" name="q12" value="65536-15625"> TCNT1 = (65536-15625);</label>
                    <label><input type="radio" name="q12" value="31250"> TCNT1 = 31250;</label>
                </div>
                <div class="feedback" data-for="q12"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q12">Tjek svar (12)</button></div>
            </section>

            <!-- Spørgsmål 13 -->
            <section class="question" aria-labelledby="q13">
                <h2 id="q13">(10 point) Mega2560's timer 1 er i CTC mode (mode 4), og CPU clockfrekvensen er 16 MHz. Timer 1's clock prescaler er 64.
                    <br>Hvilken værdi skal skrives til register OCR1A, for at generere et signal på benet OC1A, der har en frekvens på 8 Hz</h2>
                <div class="options">
                    <label><input type="radio" name="q13" value="7824" required> OCR1A = 7824;</label>
                    <label><input type="radio" name="q13" value="62499"> OCR1A = 62499;</label>
                    <label><input type="radio" name="q13" value="15624"> OCR1A = 15624;</label>
                    <label><input type="radio" name="q13" value="31248"> OCR1A = 31248;</label>
                </div>
                <div class="feedback" data-for="q13"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q13">Tjek svar (13)</button></div>
            </section>

            <!-- Spørgsmål 14 -->
            <section class="question" aria-labelledby="q14">
                <h2 id="q14">(10 point) Mega2560's timer 1 er i CTC mode (mode 4), og timer 1's clock-prescaler er sat til 8.
                    <br>Registeret OCR1A indeholder tallet 999, og på benet OC1A måles et signal med en frekvens på 250 Hz.
                    <br>Hvad er Mega2560's CPU clockfrekvens</h2>
                <div class="options">
                    <label><input type="radio" name="q14" value="2MHz" required> 2 MHz</label>
                    <label><input type="radio" name="q14" value="16MHz"> 16 MHz</label>
                    <label><input type="radio" name="q14" value="8MHz"> 8 MHz</label>
                    <label><input type="radio" name="q14" value="4MHz"> 4 MHz</label>
                </div>
                <div class="feedback" data-for="q14"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q14">Tjek svar (14)</button></div>
            </section>

            <!-- Spørgsmål 15 -->
            <section class="question" aria-labelledby="q15">
                <h2 id="q15">(10 point) Mega2560's timer 2 er initieret til "Fast PWM mode" (mode 3).
                    <br>Waveform generatoren er sat til: "Set OC2A on Compare Match, clear OC2A at BOTTOM":
                    <br>Hvad er PWM signalets duty cycle på benet OC2A, når registeret OCR2A = 64 ?</h2>
                <div class="options">
                    <label><input type="radio" name="q15" value="75%" required> Cirka 75%</label>
                    <label><input type="radio" name="q15" value="10%"> Cirka 10%</label>
                    <label><input type="radio" name="q15" value="50%"> Cirka 50%</label>
                    <label><input type="radio" name="q15" value="25%"> Cirka 25%</label>
                </div>
                <div class="feedback" data-for="q15"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q15">Tjek svar (15)</button></div>
            </section>

            <!-- Spørgsmål 16 -->
            <section class="question" aria-labelledby="q16">
                <h2 id="q16">(11 point) En Mega2560's Timer 1 er initieret til PWM mode på flg. måde:
                    <pre>TCCR1A = 0b11000011;
TCCR1B = 0b00000011;
OCR1A = 255;
CPU clockfrekvensen er 16 MHz.

Hvilken frekvens har PWM-signalet ?</pre></h2>
                <div class="options">
                    <label><input type="radio" name="q16" value="122Hz" required> Cirka 122 Hz</label>
                    <label><input type="radio" name="q16" value="488Hz"> Cirka 488 Hz</label>
                    <label><input type="radio" name="q16" value="977Hz"> Cirka 977 Hz</label>
                    <label><input type="radio" name="q16" value="244Hz"> Cirka 244 Hz</label>
                </div>
                <div class="feedback" data-for="q16"></div>
                <div class="explain" hidden>
                    <h3>Forklaring: PWM-beregning for Timer1</h3>
                    <p><strong>Antagelser:</strong> <code>TCCR1A = 0b11000011</code>, <code>TCCR1B = 0b00000011</code>, <code>OCR1A = 255</code>, <code>f_CPU = 16 MHz</code>.</p>
                    <p><strong>Trin 1 — WGM:</strong> WGM11=1, WGM10=1, WGM13=0, WGM12=0 → Mode 3 = <em>Phase Correct PWM, 10-bit</em> → <code>TOP = 1023</code>.</p>
                    <p><strong>Trin 2 — Prescaler:</strong> CS12..CS10 = <code>0b011</code> → <code>N = 64</code>.</p>
                    <p><strong>Trin 3 — Frekvens:</strong> For Phase‑Correct PWM gælder<br><code>f_PWM = f_CPU / (2 · N · TOP)</code><br>
                    Indsæt værdier: <code>f = 16 000 000 / (2 · 64 · 1023) ≈ 122.19 Hz</code>.</p>
                    <p><strong>Trin 4 — Duty:</strong> <code>OCR1A = 255</code>. Eftersom <code>COM1A1:0 = 0b11</code> er output <em>inverting</em>, derfor
                    <code>Duty = 1 − (OCR1A / TOP) ≈ 1 − 255/1023 ≈ 0.75 (≈75%)</code>. For non‑inverting sæt <code>COM1A1:0 = 0b10</code>.</p>
                </div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q16">Tjek svar (16)</button></div>
            </section>

            <!-- Spørgsmål 17 -->
            <section class="question" aria-labelledby="q17">
                <h2 id="q17">(9 point) Antag, at Mega2560 interrupt er enablet (både globalt og "lokalt") for Timer 1 overflow og for Timer 2 overflow.
                    <br>Nu laver Timer 1 overflow samtidig med, at Timer 2 laver overflow.
                    <br>Hvad sker der ?</h2>
                <div class="options">
                    <label><input type="radio" name="q17" value="opt1" required> Interrupt servicerutinen for Timer 1 overflow udføres først, og herefter interrupt servicerutinen for Timer 2 overflow.</label>
                    <label><input type="radio" name="q17" value="opt2"> Interrupt servicerutinen for Timer 2 overflow udføres først, og herefter interrupt servicerutinen for Timer 1 overflow.</label>
                    <label><input type="radio" name="q17" value="opt3"> Kun interrupt servicerutine for Timer 1 udføres.</label>
                    <label><input type="radio" name="q17" value="opt4"> Interrupt servicerutinen for Timer 1 overflow udføres samtidigt med interrupt servicerutinen for Timer 2 overflow udføres.</label>
                </div>
                <div class="feedback" data-for="q17"></div>
                <div class="explain" hidden>
                    <p><strong>Forklaring:</strong> På ATmega2560 har hvert interrupt en position i interrupt‑vektortabellen; interrupt med lavere vektoradresse har højere prioritet. På ATmega2560 ligger Timer2 overflow‑vektoren før Timer1 overflow‑vektoren, derfor bliver Timer2 overflow ISR udført først, efterfulgt af Timer1 ISR.</p>
                </div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q17">Tjek svar (17)</button></div>
            </section>

            <!-- Spørgsmål 18 -->
            <section class="question" aria-labelledby="q18">
                <h2 id="q18">(8 point) Vi ønsker at nulstille interrupt-flaget for ekstern interrupt INT7 i Mega2560.
                    <br>Hvilken metode er korrekt ?</h2>
                <div class="options">
                    <label><input type="radio" name="q18" value="opt1" required> EIFR &= 0b01111111;</label>
                    <label><input type="radio" name="q18" value="opt2"> EIFR = 1;</label>
                    <label><input type="radio" name="q18" value="opt3"> EIFR = 0b10000000;</label>
                    <label><input type="radio" name="q18" value="opt4"> EIFR = 0;</label>
                </div>
                <div class="feedback" data-for="q18"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q18">Tjek svar (18)</button></div>
            </section>

            <!-- Spørgsmål 19 -->
            <section class="question" aria-labelledby="q19">
                <h2 id="q19">(10 point) En UART er initieret til:
                    <br>BAUD rate = 4800 bit/s
                    <br>8 databits
                    <br>Ulige paritet
                    <br>2 stopbits
                    <br>Hvad er den korteste tid, det vil tage at sende 25 karakterer (f.eks. en streng på 25 tegn) ?
                    <br>Husk, at asynkron kommunikation altid begynder med 1 startbit.</h2>
                <div class="options">
                    <label><input type="radio" name="q19" value="52.1ms" required> 52,1 millisekunder</label>
                    <label><input type="radio" name="q19" value="62.5ms"> 62,5 millisekunder</label>
                    <label><input type="radio" name="q19" value="57.3ms"> 57,3 millisekunder</label>
                    <label><input type="radio" name="q19" value="46.9ms"> 46,9 millisekunder</label>
                </div>
                <div class="feedback" data-for="q19"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q19">Tjek svar (19)</button></div>
            </section>

            <!-- Spørgsmål 20 -->
            <section class="question" aria-labelledby="q20">
                <h2 id="q20">(9 point) Vi ønsker at skrive en funktion der afventer at der modtages en karakter med USART0 i vores Mega2560. Herefter skal den modtagne karakter returneres af funktionen. Hvilken funktion kan anvendes?</h2>
                <div class="options">
                    <label><input type="radio" name="q20" value="opt1" required> <pre>char getChar()
{
  while (UCSR0A & 0b10000000)
  {}
  return UDR0;
}</pre></label>
                    <label><input type="radio" name="q20" value="opt2"> <pre>char getChar()
{
  while ((UCSR0A & 0b00100000) == 0 )
  {}
  return UDR0;
}</pre></label>
                    <label><input type="radio" name="q20" value="opt3"> <pre>char getChar()
{
  while (UCSR0A & 0b00100000)
  {}
  return UDR0;
}</pre></label>
                    <label><input type="radio" name="q20" value="opt4"> <pre>char getChar()
{
  while ((UCSR0A & 0b10000000) == 0 )
  {}
  return UDR0;
}</pre></label>
                </div>
                <div class="feedback" data-for="q20"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q20">Tjek svar (20)</button></div>
            </section>

            <!-- Spørgsmål 21 -->
            <section class="question" aria-labelledby="q21">
                <h2 id="q21">(11 point) Følgende kode initierer Mega2560's A/D-konverter:
                    <pre>ADMUX  = 0b01000000;
ADCSRA = 0b10100111;
ADCSRB = 0b00000110;</pre>
                    Hvad gælder herefter for start af hver ny A/D-konvertering ?</h2>
                <div class="options">
                    <label><input type="radio" name="q21" value="opt1" required> A/D konverteren er i "Free Running Mode" (starter selv efter hver konvertering).</label>
                    <label><input type="radio" name="q21" value="opt2"> Startes automatisk af timer 0 overflow.</label>
                    <label><input type="radio" name="q21" value="opt3"> Startes automatisk af timer 1 overflow.</label>
                    <label><input type="radio" name="q21" value="opt4"> Programmøren skal "manuelt" starte hver ny A/D-konvertering ved at sætte bit ADSC.</label>
                </div>
                <div class="feedback" data-for="q21"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q21">Tjek svar (21)</button></div>
            </section>

            <!-- Spørgsmål 22 -->
            <section class="question" aria-labelledby="q22">
                <h2 id="q22">(10 point) En Mega2560's A/D-konverter skal ifølge databladet tilføres en clockfrekvens mellem 50 kHz og 200 kHz.
                    <br>Der anvendes en CPU clockfrekvens på 4 MHz.
                    <br>Hvilken initiering af registeret ADCSRA  er korrekt ?</h2>
                <div class="options">
                    <label><input type="radio" name="q22" value="opt1" required> ADCSRA = 0b10000000;</label>
                    <label><input type="radio" name="q22" value="opt2"> ADCSRA = 0b10000100;</label>
                    <label><input type="radio" name="q22" value="opt3"> ADCSRA = 0b10000111;</label>
                    <label><input type="radio" name="q22" value="opt4"> ADCSRA = 0b10000101;</label>
                </div>
                <div class="feedback" data-for="q22"></div>
                <div class="q-actions"><button type="button" class="check-single" data-q="q22">Tjek svar (22)</button></div>
            </section>



















            <div class="actions">
                <button type="button" id="checkBtn">Tjek svar</button>
                <button type="button" id="resetBtn">Nulstil</button>
            </div>

            <div id="result" aria-live="polite" class="result" hidden></div>
        </form>
    </main>

    <style>
        :root{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:16px;color:#111}
        .container{max-width:820px;margin:28px auto;padding:20px;border-radius:8px;background:#f8f9fb;border:1px solid #e0e6ee}
        h1{margin-top:0}
        .question{padding:12px;margin:10px 0;border-radius:6px;background:#fff;border:1px solid #e6eef8}
        .options{display:flex;flex-direction:column;gap:6px;margin:8px 0}
        .q-figure{margin-top:8px;margin-bottom:8px}
        .q-image{max-width:100%;height:auto;display:block;border:1px solid #e0e6ee;border-radius:6px;padding:4px}
        .q-figure figcaption{font-size:0.9em;color:#556; margin-top:6px}
        .options label.correct{background:#e6f7ea;border-left:4px solid #0b8a3a;padding:6px;border-radius:4px}
        .options label.wrong{background:#fff0f0;border-left:4px solid #c53030;padding:6px;border-radius:4px}
        .q-actions{margin-top:8px}
        input[type=text]{padding:8px;border:1px solid #c7d6e8;border-radius:4px;width:180px}
        .actions{margin-top:12px;display:flex;gap:8px}
        button{padding:8px 12px;border-radius:6px;border:1px solid #2b6cb0;background:#2b6cb0;color:#fff;cursor:pointer}
        button#resetBtn{background:#fff;color:#2b2b2b;border:1px solid #c7c7c7}
        .feedback{margin-top:6px;color:#2d3748;font-weight:600}
        .correct{color:green}
        .wrong{color:#c53030}
        .result{margin-top:14px;padding:12px;border-radius:6px;background:#e6f7ea;border:1px solid #b7e4c7}
        code{background:#eef3ff;padding:2px 6px;border-radius:4px}
    </style>

    <script>
        // Correct answers for the quiz
        const correct = {
            q1: '0b11011101',            // -35 i to-komplement
            q2: 'opt4',                 // PC=0, alle I/O som input
            q3: '21',                   // ender som 21
            q4: 'opt2',                 // mangler POP -> ubalanceret stack
            q5: '630',                  // cycles beregnet: 630
            q6: 'opt1',                 // SW1 tænder, SW0 slukker
            q7: '256us',                // 1023 cykler @4MHz ≈ 256 µs
            q8: 'opt1',
            q9: 'opt2',
            q10: 'opt3',
            q11: '8.39s',               // 16-bit med prescaler 1024 @8MHz
            q12: '65536-31250',         // startværdi = 65536 - (2s*Fclk/Presc)
            q13: '15624',
            q14: '4MHz',
            q15: '75%',
            q16: '122Hz',
            q17: 'opt2',
            q18: 'opt3',
            q19: '62.5ms',
            q20: 'opt4',
            q21: 'opt3',
            q22: 'opt4'
        };

        // Optional HTML explanations shown when an answer is wrong.
        // Put any HTML you want here (images, pre/code blocks, lists, etc.).
        // Keep it simple — trusted content that will be inserted as innerHTML.
        const explanations = {
            q1: "<strong>Forkert.</strong> To-komplement omskrives til positiv på denne måde <code>~(bits-1)</code> eller <code>bits minus 1 hvorefter alle bits vændes</code> så dermed ville dette give <code>0b11001011 - 0b1 = 0b11001010</code> complimenteret <code>~0b11001010 = 0b00110101 = 53</code> nu skal vi huske tallet er negativt.",
            q4: "<p>Rigtigt svar er at addere lavord først og derefter addere med carry til højord: <code>ADD R22,R20</code> og <code>ADC R23,R21</code>.</p>",
            q8: "<p>Man skal læse <code>PINA</code>, decrementere, komplementere og så skrive til <code>PORTB</code> — eksempel:</p><pre>IN R24,PINA\nDEC R24\nCOM R24\nOUT PORTB,R24</pre>",
            q21: "<p><strong>Forklaring:</strong> ADATE=1 (Auto Trigger) og ADTS=110 (i ADCSRB) betyder, at ADC starter automatisk når Timer/Counter1 Compare Match B forekommer — det er ikke Free Running Mode (ADTS≠0) og heller ikke Timer0 overflow eller manuel start.</p>",
            q22: "<p><strong>Forklaring:</strong> For f_CPU = 4 MHz skal ADC_clock være mellem 50–200 kHz. Tilgængelige prescalere giver ADC_clock = 4 MHz / N. Valgene N=32 (ADPS=101) → 125 kHz og N=64 (ADPS=110) → 62.5 kHz begge ligger i intervallet. Blandt de givne ADCSRA-opsætninger svarer <code>ADCSRA = 0b10000101</code> (ADEN=1, ADPS=101 → prescaler 32) til et ADC-clock ≈125 kHz, derfor er den korrekte initiering.</p>"
        };

        function collectChecked(name){
            return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(i=>i.value);
        }

        function showFeedback(q, textOrHtml, isCorrect, isHtml = false){
            const el = document.querySelector(`.feedback[data-for="${q}"]`);
            el.className = 'feedback ' + (isCorrect ? 'correct' : 'wrong');
            // If the content is flagged as HTML use innerHTML, otherwise render plain text
            if(isHtml) el.innerHTML = textOrHtml;
            else el.textContent = textOrHtml;
        }

        // Prefer inline explanation inside the question <section> (class .explain or .explanation)
        // If none is found, fall back to the JS 'explanations' map.
        function getExplanationFor(q, sec){
            try{
                const inline = sec && sec.querySelector && (sec.querySelector('.explain') || sec.querySelector('.explanation'));
                if(inline && String(inline.innerHTML || '').trim()) return inline.innerHTML;
            }catch(e){}
            return explanations[q] || null;
        }

        function clearHighlight(q){
            const sec = document.querySelector(`section[aria-labelledby="${q}"]`);
            if(!sec) return;
            sec.querySelectorAll('.options label').forEach(l=>{ l.classList.remove('correct','wrong')});
            // clear input styles
            const input = sec.querySelector('input[type=text]'); if(input){ input.style.border='1px solid #c7d6e8'; }
            const fb = sec.querySelector(`.feedback[data-for="${q}"]`); if(fb){ fb.textContent=''; fb.className='feedback'; }
        }

        function markSingle(q, correctVal){
            clearHighlight(q);
            const sec = document.querySelector(`section[aria-labelledby="${q}"]`);
            if(!sec) return;
            const sel = sec.querySelector(`input[name="${q}"]:checked`);
            if(!sel){ showFeedback(q,'Vælg et svar.', false); return; }
            if(sel.value === correctVal){ sel.parentElement.classList.add('correct'); showFeedback(q,'Korrekt!', true); }
                else{
                sel.parentElement.classList.add('wrong');
                // find correct and mark it
                const corr = sec.querySelector(`input[name="${q}"][value="${correctVal}"]`);
                if(corr) corr.parentElement.classList.add('correct');
                // Prefer an inline explanation if present, otherwise use the explanations map or fallback text
                const explainHtml = getExplanationFor(q, sec);
                if(explainHtml) showFeedback(q, explainHtml, false, true);
                else showFeedback(q,`Forkert — korrekt svar er markeret nedenfor.`, false);
            }
        }

        function markMulti(q, correctArray){
            clearHighlight(q);
            const sec = document.querySelector(`section[aria-labelledby="${q}"]`);
            if(!sec) return;
            const checkboxes = Array.from(sec.querySelectorAll(`input[name="${q}"]`));
            const chosen = checkboxes.filter(i=>i.checked).map(i=>i.value);
            const expected = new Set(correctArray);
            // mark all correct options green
            checkboxes.forEach(i=>{
                const lab = i.parentElement;
                if(expected.has(i.value)) lab.classList.add('correct');
            });
            // mark any chosen-but-wrong red
            let anyWrong=false;
            chosen.forEach(v=>{ if(!expected.has(v)){ anyWrong=true; const inp = sec.querySelector(`input[name="${q}"][value="${v}"]`); if(inp) inp.parentElement.classList.add('wrong'); } });
            if(chosen.length===0){ showFeedback(q,'Vælg mindst én.', false); }
            else if(!anyWrong && chosen.length === expected.size){ showFeedback(q, 'Korrekt — alle rigtige valgmuligheder valgt.', true); }
            else{
                const explainHtml = getExplanationFor(q, sec);
                if(explainHtml) showFeedback(q, explainHtml, false, true);
                else showFeedback(q, 'Forkert — korrekte svar er markeret.', false);
            }
        }

        function markText(q, expected){
            clearHighlight(q);
            const sec = document.querySelector(`section[aria-labelledby="${q}"]`);
            if(!sec) return;
            const input = sec.querySelector('input[type=text]');
            const value = (input.value||'').trim();
            if(!value){ showFeedback(q,'Skriv venligst et svar.', false); input.style.border='1px solid #c53030'; return; }
            if(value === expected){ showFeedback(q,'Korrekt!', true); input.style.border='2px solid #0b8a3a'; }
            else{
                const explainHtml = getExplanationFor(q, sec);
                if(explainHtml) showFeedback(q, explainHtml, false, true);
                else showFeedback(q,`Forkert — korrekt svar er ${expected}.`, false);
                input.style.border='2px solid #c53030';
            }
        }

        function getPointsForSection(sec){
            if(!sec) return 10; // default
            try{
                const h = sec.querySelector('h2');
                const txt = (h && h.textContent) ? h.textContent : '';
                const m = txt.match(/(\d+)\s*point/i);
                if(m) return parseInt(m[1],10);
            }catch(e){}
            return 10;
        }

        function evaluate(){
            let earned = 0;
            let totalPoints = 0;
            const keys = Object.keys(correct);

            keys.forEach(q=>{
                const ans = correct[q];
                const sec = document.querySelector(`section[aria-labelledby="${q}"]`);
                if(!sec) return;

                const pts = getPointsForSection(sec);
                totalPoints += pts;

                // clear visuals first
                sec.querySelectorAll('.options label').forEach(l=>{ l.classList.remove('correct','wrong') });

                if(Array.isArray(ans)){
                    // multi
                    const chosen = collectChecked(q);
                    const expected = new Set(ans);
                    // mark correct ones green
                    sec.querySelectorAll(`input[name="${q}"]`).forEach(inp=>{ const lab = inp.parentElement; if(expected.has(inp.value)) lab.classList.add('correct'); });
                    // mark chosen-but-wrong red
                    let wrong=false;
                    chosen.forEach(v=>{ if(!expected.has(v)){ wrong=true; const i=sec.querySelector(`input[name="${q}"][value="${v}"]`); if(i) i.parentElement.classList.add('wrong'); }});
                    if(chosen.length>0 && !wrong && chosen.length === expected.size){ earned += pts; showFeedback(q,`Korrekt (${pts} point)`, true);} else {
                        if(chosen.length===0) showFeedback(q, 'Vælg mindst én.', false);
                        else {
                            const explainHtml = getExplanationFor(q, sec);
                            if(explainHtml) showFeedback(q, explainHtml, false, true);
                            else showFeedback(q, 'Forkert — korrekte svar er markeret.', false);
                        }
                    }
                } else {
                    // single radio OR text
                    const textInput = sec.querySelector('input[type=text]');
                    if(textInput){ const val=(textInput.value||'').trim(); if(val === ans){ earned += pts; showFeedback(q,`Korrekt (${pts} point)`, true); textInput.style.border='2px solid #0b8a3a' } else { const explainHtml = getExplanationFor(q, sec); if(explainHtml) showFeedback(q, explainHtml, false, true); else showFeedback(q, val?`Forkert — korrekt svar er ${ans}.`:'Skriv venligst et svar.', false); textInput.style.border='2px solid #c53030' } }
                    else {
                        const selected = sec.querySelector(`input[name="${q}"]:checked`);
                        if(!selected){ showFeedback(q,'Du skal vælge et svar.', false); }
                        else { if(selected.value === ans){ earned += pts; selected.parentElement.classList.add('correct'); showFeedback(q,`Korrekt (${pts} point)`, true);} else { selected.parentElement.classList.add('wrong'); const corr = sec.querySelector(`input[name="${q}"][value="${ans}"]`); if(corr) corr.parentElement.classList.add('correct'); const explainHtml = getExplanationFor(q, sec); if(explainHtml) showFeedback(q, explainHtml, false, true); else showFeedback(q, 'Forkert — korrekt svar er markeret.', false);} }
                    }
                }
            });

            // Show summary
            const result = document.getElementById('result');
            result.hidden = false;
            const pct = totalPoints ? Math.round((earned/totalPoints)*100) : 0;
            result.innerHTML = `<strong>Din score:</strong> ${earned} / ${totalPoints} (${pct}%)`;
            if(earned === totalPoints) result.style.background = '#e6f7ea';
            else result.style.background = '#fff3cd';
        }

        // attach per-question buttons
        document.querySelectorAll('.check-single').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                const q = btn.dataset.q;
                markSingle(q, correct[q]);
            });
        });
        document.querySelectorAll('.check-multi').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                const q = btn.dataset.q;
                markMulti(q, correct[q]);
            });
        });
        document.querySelectorAll('.check-text').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                const q = btn.dataset.q;
                const expected = btn.dataset.answer || correct[q];
                markText(q, expected);
            });
        });

        // 'Tjek svar' still checks all questions (existing behaviour)
        document.getElementById('checkBtn').addEventListener('click', ()=>{
            // Clear feedback for a fresh run
            document.querySelectorAll('.feedback').forEach(n=>{n.textContent=''; n.className='feedback'});
            document.getElementById('result').hidden = true;
            evaluate();
        });

        document.getElementById('resetBtn').addEventListener('click', ()=>{
            document.getElementById('quizForm').reset();
            document.querySelectorAll('.feedback').forEach(n=>{n.textContent=''; n.className='feedback'});
            // clear visuals for all questions
            document.querySelectorAll('.options label').forEach(l=>{ l.classList.remove('correct','wrong') });
            document.querySelectorAll('input[type=text]').forEach(i=> i.style.border='1px solid #c7d6e8');
            const result = document.getElementById('result'); result.hidden = true; result.textContent = '';
        });
    </script>
</body>
</html>